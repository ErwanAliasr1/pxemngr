#!/usr/bin/python
#---------------------------------------------------------------
# Project         : pxemngr
# File            : dpysystem
# Copyright       : 2009 Splitted-Desktop Systems
# Author          : Frederic Lepied
# Created On      : Sun Feb  1 13:54:41 2009
# Purpose         : report the list of systems or informations
#                 about one system.
#---------------------------------------------------------------

import sys
import settings
from pxe.models import *
from pxe.common import *

if len(sys.argv) != 2:
    error('Usage: %s <system name>|-l' % sys.argv[0])

if sys.argv[1] == '-l':
    for s in System.objects.all():
        print s.name
else:
    try:
        system = System.objects.get(name=sys.argv[1])
    except System.DoesNotExist:
        error('System %s not defined' % sys.argv[1])
    
    print 'Name:', system.name
    
    for mac in MacAddress.objects.filter(system=system):
        print 'Mac:',
        r = ''
        for i in range(0, 10, 2):
            r = r +  '%s:' % mac.mac[i:i+2]
        r = r + mac.mac[10:12]
        print '%s (%s)' % (r, mac_to_ip(r))
    
    logs = Log.objects.filter(system=system).order_by('-date')
    if len(logs) >= 1:
        print 'Next boot:', logs[0].boot_name.name
    
    print 'History:'
    for l in logs[1:10]:
        print l.date, l.boot_name.name
    
# addsystem ends here
